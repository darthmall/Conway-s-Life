(function(){function a(g,v,o,q,u){var s=g.get(0).getContext("2d");var i=[];var m=null;function l(){s.lineSize=1;s.strokeStyle="#888888";s.beginPath();for(var z=-0.5;z<g.attr("width")-0.5;z+=v){s.moveTo(z,0);s.lineTo(z,g.height());s.moveTo(0,z);s.lineTo(g.width(),z)}s.stroke();s.closePath()}function w(){i=[];for(var z=0;z<q*o;z++){i[z]=false}}function r(z,B){var A=B*q+z;c(z,B,!i[A],i)}function y(){g.attr({width:v*q,height:v*o})}function x(H,G){var F=0;var C=Math.max(H-1,0);var A=Math.min(H+1,q-1);var B=Math.max(G-1,0);var z=Math.min(G+1,o-1);for(var E=C;E<=A;E++){for(var D=B;D<=z;D++){if(E!==H||D!==G){F+=(i[D*q+E])?1:0}}}return F}function c(z,C,B,A){A[C*q+z]=B;s.fillStyle=B?"#ff0000":"#ffffff";s.fillRect(z*v,C*v,v-1,v-1)}function n(){var C=[];for(var B=0;B<q*o;B++){var z=B%q;var D=Math.floor(B/q);var A=b(z,D);c(z,D,A,C)}i=C;m=setTimeout(n,1000/u)}function t(){clearTimeout(m);m=null}function b(z,B){var A=x(z,B);return((i[B*q+z]&&A>=2&&A<=3)||(!i[B*q+z]&&A===3))}function k(z){v=z;y();l()}function e(z){q=z;w();y();l()}function j(z){o=z;w();y();l()}function h(z){u=z}function d(B){for(var A=0;A<q;A++){for(var z=0;z<o;z++){c(A,z,(Math.random()<=B),i)}}}function f(){return(m!==null)}function p(){for(var A=0;A<q;A++){for(var z=0;z<o;z++){c(A,z,false,i)}}}this.setCellSize=k;this.setWidth=e;this.setHeight=j;this.setSpeed=h;this.run=n;this.stop=t;this.randomize=d;this.running=f;this.clear=p;g.click(function(z){r(Math.floor(z.offsetX/v),Math.floor(z.offsetY/v))});w();y();l()}$(document).ready(function(){var c=0.3;var d=10;var b=new a($("#board"),parseInt($("#cellsize").val()),parseInt($("#boardwidth").val()),parseInt($("#boardheight").val()),d);$("#cellsize").change(function(){b.setCellSize(parseInt($(this).val()))});$("#boardwidth").change(function(){b.setWidth(parseInt($(this).val()))});$("#boardheight").change(function(){b.setHeight(parseInt($(this).val()))});$("#speedslider").slider({range:"min",value:d,min:0.5,max:60,step:0.5,slide:function(e,f){$("#speeddisplay").attr("innerHTML",f.value);b.setSpeed(f.value)}});$("#speeddisplay").attr("innerHTML",d);$("#saturationslider").slider({range:"min",value:c,min:0.01,max:1,step:0.01,slide:function(e,f){$("#saturationdisplay").attr("innerHTML",f.value);c=f.value}});$("#clear").button().click(b.clear);$("#randomize").button().click(function(){b.randomize(c)});$("#startstop").button().click(function(){if(b.running()){$(this).children(".ui-button-text").attr("innerHTML","Start");b.stop()}else{$(this).children(".ui-button-text").attr("innerHTML","Stop");b.run()}});$("#showrules").click(function(){$("#rules").css({left:($(window).width()-$("#rules").width())/2,top:($(window).height()-$("#rules").height())/2}).show()});$("#rules").click(function(){$(this).hide()})})})();